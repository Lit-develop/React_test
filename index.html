<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>React App - ДикиеЯгоды</title>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>

    <script type="text/babel">
      // Компонент кнопки
      function BasicButton({ btn_msg }) {
        const handleClick = () => {
          alert(btn_msg);
        };

        return <button onClick={handleClick} type="button" className="btn btn-primary" style={{marginRight:'10px', marginBottom: '10px'}}>Нажми меня</button>;
      }

      // Menu
      function Menu() {
        return (
          <nav className="navbar navbar-expand-lg bg-body-tertiary">
            <div className="container-fluid">
              <a className="navbar-brand" href="#">
                <img
                  src="img/logo.png"
                  width={50}
                  height={50}
                  style={{marginRight:'10px'}}
                />
                ДикиеЯгоды 
              </a>
              <button
                className="navbar-toggler"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#navbarNav"
                aria-controls="navbarNav"
                aria-expanded="false"
                aria-label="Toggle navigation"
              >
                <span className="navbar-toggler-icon" />
              </button>
              <div className="collapse navbar-collapse" id="navbarNav" style={{justifyContent: 'flex-end'}}>
                <ul className="navbar-nav">
                  <li className="nav-item">
                    <a className="nav-link active" aria-current="page" href="#">
                      Главная
                    </a>
                  </li>
                  <li className="nav-item">
                    <a className="nav-link" href="#">
                      Отзывы
                    </a>
                  </li>
                  <li className="nav-item">
                    <a className="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#exampleModal">
                      Профиль
                    </a>
                  </li>
                  <li className="nav-item">
                    <a className="nav-link disabled" aria-disabled="true">
                      Удалить WB
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </nav>
        );
      }

      // Модальное окно как React компонент
      function ExampleModal() {
        return (
          <div
            className="modal fade"
            id="exampleModal"
            tabIndex={-1}
            aria-labelledby="exampleModalLabel"
            aria-hidden="true"
          >
            <div className="modal-dialog">
              <div className="modal-content">
                <div className="modal-header">
                  <h1 className="modal-title fs-5" id="exampleModalLabel">
                    Заголовок модального окна
                  </h1>
                  <button
                    type="button"
                    className="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Закрыть"
                  />
                </div>
                <div className="modal-body">
                  Содержимое модального окна...
                </div>
                <div className="modal-footer">
                  <button
                    type="button"
                    className="btn btn-secondary"
                    data-bs-dismiss="modal"
                  >
                    Закрыть
                  </button>
                  <button type="button" className="btn btn-primary">
                    Сохранить изменения
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      // Кнопка-триггер модального окна
      function ModalButton() {
        return (
          <button
            type="button"
            className="btn btn-primary"
            data-bs-toggle="modal"
            data-bs-target="#exampleModal"
            style={{marginRight:'10px', marginBottom: '10px'}}
          >
            Запустите демо модального окна
          </button>
        );
      }

      // Компонент приветствия
      function Greeting({ name }) {
        return <h1>Доброе утро, {name}</h1>;
      }

      // Компонент модального окна для карточки
      function CardModal({ id, title, img_url, description, price }) {
        return (
          <div
            className="modal fade"
            id={`cardModal-${id}`}
            tabIndex={-1}
            aria-labelledby={`cardModalLabel-${id}`}
            aria-hidden="true"
          >
            <div className="modal-dialog modal-lg">
              <div className="modal-content">
                <div className="modal-header">
                  <h1 className="modal-title fs-5" id={`cardModalLabel-${id}`}>
                    {title}
                  </h1>
                  <button
                    type="button"
                    className="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Закрыть"
                  />
                </div>
                <div className="modal-body">
                  <div className="text-center mb-3">
                    <img 
                      src={img_url} 
                      className="img-fluid rounded" 
                      alt={title} 
                      style={{maxHeight: "400px", objectFit: "cover"}} 
                    />
                  </div>
                  <p className="mb-3">{description}</p>
                  {price && <p className="fw-bold">Цена: {price} руб.</p>}
                </div>
                <div className="modal-footer">
                  <button
                    type="button"
                    className="btn btn-secondary"
                    data-bs-dismiss="modal"
                  >
                    Закрыть
                  </button>
                  <button type="button" className="btn btn-primary">
                    Добавить в корзину
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      // Компонент карточки
      function Card({ id, img_url, title, description, price }) {
        return (
          <div className="col-md-4 col-lg-3 mb-4">
            <div className="card h-100">
              <img src={img_url} className="card-img-top" alt={title} style={{height: "200px", objectFit: "cover"}} />
              <div className="card-body d-flex flex-column">
                <h5 className="card-title">{title}</h5>
                <p className="card-text flex-grow-1">
                  {description}
                </p>
                {price && <p className="card-text fw-bold">Цена: {price} руб.</p>}
                <button 
                  type="button" 
                  className="btn btn-primary mt-auto"
                  data-bs-toggle="modal"
                  data-bs-target={`#cardModal-${id}`}
                >
                  Открыть карточку
                </button>
              </div>
            </div>
            <CardModal 
              id={id}
              title={title}
              img_url={img_url}
              description={description}
              price={price}
            />
          </div>
        );
      }

      // Компонент состояния загрузки
      function LoadingSpinner() {
        return (
          <div className="d-flex justify-content-center my-5">
            <div className="spinner-border text-primary" role="status">
              <span className="visually-hidden">Загрузка...</span>
            </div>
          </div>
        );
      }

      // Компонент ошибки
      function ErrorMessage({ message }) {
        return (
          <div className="alert alert-danger my-4" role="alert">
            <h4 className="alert-heading">Ошибка загрузки данных</h4>
            <p>{message}</p>
            <button className="btn btn-danger" onClick={() => window.location.reload()}>
              Попробовать снова
            </button>
          </div>
        );
      }

      // Главный компонент приложения
      function App() {
        const [items, setItems] = React.useState([]);
        const [loading, setLoading] = React.useState(true);
        const [error, setError] = React.useState(null);

        // Загрузка данных из JSON файла
        React.useEffect(() => {
          const fetchItems = async () => {
            try {
              setLoading(true);
              const response = await fetch('items.json');
              
              if (!response.ok) {
                throw new Error(`Ошибка HTTP: ${response.status}`);
              }
              
              const data = await response.json();
              setItems(data);
              setError(null);
            } catch (err) {
              setError(err.message);
              console.error('Ошибка при загрузке данных:', err);
            } finally {
              setLoading(false);
            }
          };

          fetchItems();
        }, []);

        return (
          <div>
            <Menu/>
            <div className="container">
              <Greeting name="уважаемый пользователь!" />
              
              {/* Состояние загрузки */}
              {loading && <LoadingSpinner />}
              
              {/* Сообщение об ошибке */}
              {error && <ErrorMessage message={error} />}
              
              {/* Карточки, загруженные из JSON */}
              {!loading && !error && (
                <div className="row justify-content-center">
                  {items.map(item => (
                    <Card 
                      key={item.id}
                      id={item.modal_id}
                      img_url={item.img_url} 
                      title={item.title} 
                      description={item.description}
                      price={item.price}
                    />
                  ))}
                </div>
              )}
              
              {/* Кнопки */}
              <div className="text-center mt-4">
                <BasicButton btn_msg="Первая кнопка была нажата!" />
                <BasicButton btn_msg="Вторая кнопка тоже была нажата!" />
                <ModalButton />
              </div>
              <ExampleModal />
            </div>
            <Menu/>
          </div>
        );
      }

      // Рендерим приложение
      ReactDOM.render(<App />, document.getElementById("root"));
    </script>
  </body>
</html>
